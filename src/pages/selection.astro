---
import Layout from '../layouts/Layout.astro';
import MatiereCard from '../components/MatiereCard.svelte';
import { loadAllQCMs, getMatieres } from '../lib/qcmParser';

// Charger tous les QCM disponibles
const allQCMs = await loadAllQCMs();
const matieres = getMatieres(allQCMs);

// Grouper les QCM par matiÃ¨re
const qcmsByMatiere = matieres.map((matiere) => ({
  matiere,
  qcms: allQCMs.filter((qcm) => qcm.frontmatter.matiere === matiere),
}));

// IcÃ´nes et couleurs par matiÃ¨re
const matiereConfig: {
  [key: string]: { icon: string; color: string };
} = {
  MathÃ©matiques: { icon: 'ğŸ”¢', color: 'blue' },
  FranÃ§ais: { icon: 'ğŸ“š', color: 'green' },
  Sciences: { icon: 'ğŸ”¬', color: 'purple' },
  Histoire: { icon: 'ğŸ›ï¸', color: 'orange' },
  GÃ©ographie: { icon: 'ğŸŒ', color: 'pink' },
  Anglais: { icon: 'ğŸ‡¬ğŸ‡§', color: 'yellow' },
};
---

<Layout title="Ã‰cole Interactive - Choix de la matiÃ¨re">
  <div class="mx-auto max-w-6xl">
    <div class="mb-12 text-center">
      <h1 class="mb-4 text-5xl font-bold text-gray-800">Quelle matiÃ¨re veux-tu rÃ©viser ?</h1>
      <p class="text-xl text-gray-600">Choisis une matiÃ¨re pour commencer Ã  apprendre !</p>
    </div>

    <div class="mb-8 text-center">
      <a
        href={import.meta.env.BASE_URL}
        class="inline-block rounded-xl bg-gray-200 px-6 py-3 text-lg font-semibold text-gray-700 transition-all hover:bg-gray-300"
      >
        â† Changer d'utilisateur
      </a>
    </div>

    {
      qcmsByMatiere.length === 0 ? (
        <div class="rounded-3xl bg-white p-12 text-center shadow-lg">
          <div class="mb-4 text-6xl">ğŸ“­</div>
          <h2 class="mb-2 text-3xl font-bold text-gray-800">Aucun QCM disponible</h2>
          <p class="text-xl text-gray-600">
            Les QCM n'ont pas encore Ã©tÃ© ajoutÃ©s. Consultez le README pour ajouter des QCM.
          </p>
        </div>
      ) : (
        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {
            qcmsByMatiere.map(({ matiere, qcms }) => {
              const config = matiereConfig[matiere] || { icon: 'ğŸ“–', color: 'blue' };
              const firstQCMId = qcms[0]?.frontmatter.id;
              return (
                <MatiereCard
                  matiere={matiere}
                  count={qcms.length}
                  icon={config.icon}
                  color={config.color}
                  href={`${import.meta.env.BASE_URL}qcm/${firstQCMId}`}
                  client:load
                />
              );
            })
          }
        </div>
      )
    }
  </div>
</Layout>
